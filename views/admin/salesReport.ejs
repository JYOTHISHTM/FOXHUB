<%- include('../adminLayouts/header.ejs') %>
<%- include('../adminLayouts/sidenavbar.ejs') %>

<div class="body-wrapper">
  <header class="app-header">
    <!-- ... (Header navigation code) ... -->
  </header>

  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .hhh {
      width: 90%;
      margin-left: 5%;
      margin-top: 5%;
    }
    h1, h2 {
      color: #333;
    }
    form {
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
    }
    select, input[type="date"], button {
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      background-color: #5D87FF;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #5D87FF;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .custom-date {
      display: none;
    }
    .no-orders {
      padding: 16px;
      text-align: center;
      border: 1px solid #ddd;
      margin-top: 20px;
      background-color: #f9f9f9;
    }
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .pagination a {
      color: black;
      float: left;
      padding: 8px 16px;
      text-decoration: none;
      transition: background-color 0.3s;
      border: 1px solid #ddd;
      margin: 0 4px;
    }
    .pagination a.active {
      background-color: #5D87FF;
      color: white;
      border: 1px solid #5D87FF;
    }
    .pagination a:hover:not(.active) {
      background-color: #ddd;
    }
    .download-links a {
      margin-right: 10px;
      color: #ffffff;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s ease;
    }
    .download-links a:hover {
      color: #fdfdfe;
    }
  </style>

  <script>
    function toggleCustomDateFields() {
      const filter = document.getElementById('filter').value;
      const customDateFields = document.getElementById('custom-date-fields');
      customDateFields.style.display = filter === 'custom' ? 'block' : 'none';
    }
  </script>
</head>

<body>
  <div class="hhh">
    <h1>Sales Report</h1>
    <form action="/admin/salesReport" method="post">
      <label for="filter">Filter by:</label>
      <select name="filter" id="filter" onchange="toggleCustomDateFields()">
        <option value="day" <%= filter === 'day' ? 'selected' : '' %>>Day</option>
        <option value="week" <%= filter === 'week' ? 'selected' : '' %>>Week</option>
        <option value="month" <%= filter === 'month' ? 'selected' : '' %>>Month</option>
        <option value="custom" <%= filter === 'custom' ? 'selected' : '' %>>Custom</option>
      </select>
      <div id="custom-date-fields" class="custom-date" style="<%= filter === 'custom' ? 'display: block;' : 'display: none;' %>">
        <label for="startDate">Start Date:</label>
        <input type="date" name="startDate" id="startDate" value="<%= startDate %>">
        <label for="endDate">End Date:</label>
        <input type="date" name="endDate" id="endDate" value="<%= endDate %>">
      </div>
      <button type="submit">Apply</button>
    </form>

    <% if (reportData.length === 0) { %>
      <div class="no-orders">No orders found</div>
    <% } else { %>
      <table>
        <thead>
          <tr>
            <th>Number</th>
            <th>Name</th>
            <th>Product</th>
            <th>Amount</th>
            <th>Discount</th>
            <th>Payment Method</th>
            <th>Final Price</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          <% reportData.forEach(item => { %>
            <tr>
              <td><%= item.number %></td>
              <td><%= item.name %></td>
              <td><%= item.product %></td>
              <td><%= item.amount %></td>
              <td><%= item.discount %></td>
              <td><%= item.paymentMethod %></td>
              <td><%= item.finalPrice %></td>
              <td><%= item.status %></td>
            </tr>
          <% }); %>
        </tbody>
      </table>

      <div class="pagination">
        <% if (currentPage > 1) { %>
          <a href="?filter=<%= filter %>&page=<%= currentPage - 1 %><%= filter === 'custom' ? `&startDate=${startDate}&endDate=${endDate}` : '' %>">&laquo; Previous</a>
        <% } %>
        
        <% for (let i = 1; i <= totalPages; i++) { %>
          <a href="?filter=<%= filter %>&page=<%= i %><%= filter === 'custom' ? `&startDate=${startDate}&endDate=${endDate}` : '' %>" class="<%= currentPage === i ? 'active' : '' %>"><%= i %></a>
        <% } %>
        
        <% if (currentPage < totalPages) { %>
          <a href="?filter=<%= filter %>&page=<%= currentPage + 1 %><%= filter === 'custom' ? `&startDate=${startDate}&endDate=${endDate}` : '' %>">Next &raquo;</a>
        <% } %>
      </div>

      <h2>Overall Sales Summary</h2>
      <p>Overall Sales Count: <%= overallSalesCount %></p>
      <p>Overall Amount: <%= overallAmount %></p>
      <p>Overall Discount: <%= overallDiscount %></p>
      <p>Overall Profit: <%= overallProfit %></p>
    <% } %>

    <div class="download-links">
      <a class="btn btn-primary" href="/admin/salesReport/pdf?filter=<%= filter %><%= filter === 'custom' ? `&startDate=${startDate}&endDate=${endDate}` : '' %>" target="_blank">Download PDF</a>
      <a class="btn btn-primary" href="/admin/salesReport/excel?filter=<%= filter %><%= filter === 'custom' ? `&startDate=${startDate}&endDate=${endDate}` : '' %>" target="_blank">Download Excel</a>
    </div>
  </div>

</body>
<%- include('../adminLayouts/footer.ejs') %>
